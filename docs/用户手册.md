# Codeck 用户手册

欢迎使用 **Codeck** - HOI4 MOD 可视化编程工具！本手册将帮助你快速上手使用 Codeck 来创建 Hearts of Iron IV (钢铁雄心4) MOD 脚本。

## 目录

1. [简介](#简介)
2. [安装与运行](#安装与运行)
3. [界面概览](#界面概览)
4. [基本操作](#基本操作)
5. [节点介绍](#节点介绍)
6. [变量管理](#变量管理)
7. [项目管理](#项目管理)
8. [代码生成](#代码生成)
9. [设置](#设置)
10. [常见问题](#常见问题)

---

## 简介

Codeck 是一款基于 Python 和 PySide6 的可视化蓝图编程引擎。它允许你使用基于节点的界面来创建 HOI4 MOD 脚本，无需手动编写复杂的代码。

### 特点

- **可视化节点编辑器**: 通过拖放节点来创建程序
- **自动代码生成**: 从你的蓝图自动生成 HOI4 脚本
- **变量管理**: 创建和管理可在蓝图中使用的变量
- **内置节点**: 包含核心节点和逻辑节点
- **保存/加载**: 将蓝图保存为 JSON 文件
- **深色/浅色主题**: 现代化的界面主题

### 系统要求

- Python 3.10 或更高版本
- PySide6

---

## 安装与运行

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行程序

```bash
python run.py
```

或者：

```bash
python -m codeck.main
```

---

## 界面概览

启动 Codeck 后，你会看到以下界面区域：

### 1. 项目管理页面（首页）

- **左侧边栏**: 新建项目、打开项目、设置按钮
- **右侧区域**: 显示最近打开的项目列表

### 2. 编辑器页面

- **左侧面板**: 文件操作、构建配置、变量管理
- **中间区域**: 节点编辑画布
- **下方区域**: 生成的代码预览

### 3. 菜单栏

- **文件**: 新建、打开、保存项目
- **编辑**: 重置画布
- **设置**: 语言和主题设置

---

## 基本操作

### 添加节点

1. 在画布上 **右键点击** 打开上下文菜单
2. 选择想要添加的节点类型
3. 节点会出现在点击位置

### 连接节点

1. 点击一个节点的 **输出端口**（右侧的圆点或箭头）
2. 拖动到另一个节点的 **输入端口**（左侧的圆点或箭头）
3. 松开鼠标完成连接

### 移动节点

- 点击并拖动节点即可移动

### 删除节点或连接

1. 点击选中要删除的节点或连接
2. 按 **Delete** 或 **Backspace** 键删除

### 画布操作

- **平移**: 按住 **中键** 或 **空格+左键** 拖动
- **缩放**: 使用 **鼠标滚轮**
- **聚焦**: 按 **F** 键聚焦到节点

### 取消连接

- 在连接过程中按 **Esc** 键取消

---

## 节点介绍

### 核心节点 (Core)

#### Begin（开始节点）
- 程序的起点
- 每个蓝图必须有且只有一个 Begin 节点
- 不能删除

#### Log（日志节点）
- 输出调试信息
- 输入: 执行流、消息内容
- 输出: 执行流

#### Alert（警告节点）
- 显示警告消息
- 输入: 执行流、消息内容
- 输出: 执行流

#### If（条件节点）
- 根据条件执行不同分支
- 输入: 执行流、条件
- 输出: 真分支执行流、假分支执行流

#### ForEach（遍历节点）
- 遍历数组中的每个元素
- 输入: 执行流、数组
- 输出: 循环体执行流、完成后执行流

#### Loop（循环节点）
- 执行指定次数的循环
- 输入: 执行流、循环次数
- 输出: 循环体执行流、完成后执行流

### 逻辑节点 (Logic)

#### 数学运算
- **Add**: 加法
- **Subtract**: 减法
- **Multiply**: 乘法
- **Divide**: 除法

#### 比较运算
- **Equal**: 等于
- **Greater Than**: 大于
- **Less Than**: 小于

#### 布尔运算
- **And**: 与运算
- **Or**: 或运算
- **Not**: 非运算

### 变量节点

#### VarGet（获取变量）
- 获取变量的值
- 输出: 变量值

#### VarSet（设置变量）
- 设置变量的值
- 输入: 执行流、新值
- 输出: 执行流

---

## 变量管理

### 创建变量

1. 点击左侧面板的 **"创建变量 ▼"** 展开变量创建区域
2. 输入变量名（必须以字母或下划线开头）
3. 选择变量类型：
   - **string**: 字符串
   - **number**: 数字
   - **boolean**: 布尔值
   - **object**: 对象
   - **array**: 数组
4. 可选：输入默认值
5. 点击 **"创建变量"** 按钮

### 使用变量

1. 在画布上右键点击
2. 选择 **"变量"** 菜单
3. 选择要使用的变量
4. 选择 **"获取变量"** 或 **"设置变量"**

### 删除变量

1. 在左侧面板的变量列表中找到要删除的变量
2. 点击 **"删除"** 按钮

---

## 项目管理

### 新建项目

1. 点击 **"新建项目"** 按钮
2. 输入 MOD 名称（必填）
3. 输入 MOD 描述（可选）
4. 选择项目保存路径
5. 点击 **"新建项目"** 按钮

### 打开项目

1. 点击 **"打开项目"** 按钮
2. 选择 `.modproj` 或 `.json` 文件
3. 项目将加载到编辑器中

### 保存项目

- **保存 (Ctrl+S)**: 保存到当前文件
- **另存为**: 保存到新文件

### 最近项目

- 在首页右侧显示最近打开的项目
- 点击项目卡片可快速打开

---

## 代码生成

### 运行/预览

1. 点击左侧面板的 **"运行"** 按钮
2. 生成的代码将显示在下方的代码预览区域
3. 弹窗显示生成成功消息和代码预览

### 导出 MOD 脚本

1. 展开左侧面板的 **"构建 ▼"** 区域
2. 选择脚本类型：
   - **事件 (Event)**: 游戏事件脚本
   - **决议 (Decision)**: 决议脚本
   - **国策 (Focus)**: 国策树脚本
3. 输入命名空间（用于脚本标识）
4. 点击 **"导出 MOD 脚本"** 按钮
5. 选择保存位置

### 代码格式

生成的代码遵循 HOI4 脚本格式：

```
# HOI4 MOD Script
# Generated by Codeck Visual Blueprint Editor
# Namespace: my_mod
# Type: event

add_namespace = my_mod

# 变量定义 / Variable Definitions
set_variable = { var = counter value = 0 }

# 你的脚本代码...
```

---

## 设置

### 打开设置

- 点击菜单栏 **"设置" → "设置"**
- 或在首页点击 **"设置"** 按钮

### 语言设置

- **中文**: 简体中文界面
- **English**: 英文界面

更改语言后，界面会立即更新。

### 主题设置

- **深色主题**: 适合低光环境
- **浅色主题**: 适合日间使用

更改主题后，界面会立即更新。

---

## 常见问题

### Q: 为什么我的节点无法连接？

A: 检查以下几点：
- 确保连接方向正确（从输出端口到输入端口）
- 执行流端口只能连接执行流端口
- 数据端口的类型需要兼容

### Q: 如何删除 Begin 节点？

A: Begin 节点是必需的，不能删除。每个蓝图都必须有一个起点。

### Q: 生成的代码在哪里？

A: 生成的代码会显示在编辑器下方的代码预览区域。你也可以使用"导出 MOD 脚本"功能将代码保存为文件。

### Q: 项目文件保存在哪里？

A: 项目文件保存在你选择的路径。默认扩展名为 `.modproj`，实际上是 JSON 格式。

### Q: 如何重置画布？

A: 点击左侧面板的"重置"按钮，或使用菜单栏的"编辑→重置"。注意：这会清除所有未保存的更改。

### Q: 设置保存在哪里？

A: 设置文件保存在系统配置目录：
- Windows: `%APPDATA%/codeck/settings.json`
- macOS: `~/Library/Application Support/codeck/settings.json`
- Linux: `~/.config/codeck/settings.json`

---

## 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| 右键 | 打开节点添加菜单 |
| Delete / Backspace | 删除选中项 |
| 空格 + 左键 | 平移画布 |
| 中键 | 平移画布 |
| 滚轮 | 缩放画布 |
| F | 聚焦节点 |
| Esc | 取消当前操作 |

---

## 获取帮助

如果你在使用过程中遇到问题，可以：

1. 查看本用户手册
2. 查看 [API 文档](./API文档.md)
3. 在项目仓库提交 Issue

祝你使用愉快！🎮
